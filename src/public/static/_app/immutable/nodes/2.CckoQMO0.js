import"../chunks/DsnmJJEf.js";import{s as Y,o as _e}from"../chunks/q_g5uFsb.js";import{s as K,h as T,q as me,e as ae,a as he,b as ge,y as b,aq as pe,r as be,H as Ie,c as $,d as L,k as z,O as we,S as Ee,f as J,i as Me,g as ye,X as te,K as xe,az as Ae,aD as ee,aE as Ce,j as re,p as Ne,aF as Se,aG as V,o as se,aH as Te,aI as De,Q as ke,aJ as He,W as Oe,aK as Fe,M as Re,u as B,F as y,w as H,v as R,x as D,C,B as O,ai as ne,z as F,A as G,ah as P,aB as le,ar as Ue}from"../chunks/Bc7h0uXr.js";import{i as qe}from"../chunks/CXfXxH9F.js";import{c as W,a as Z,M as j,r as ie,b as oe,s as ze}from"../chunks/Dxw6WGxI.js";import{d as ue}from"../chunks/B6qlxeud.js";function Be(r,a){return a}function Ge(r,a,e){for(var t=r.items,l=[],s=a.length,n=0;n<s;n++)He(a[n].e,l,!0);var u=s>0&&l.length===0&&e!==null;if(u){var _=e.parentNode;Oe(_),_.append(e),t.clear(),A(r,a[0].prev,a[s-1].next)}Fe(l,()=>{for(var h=0;h<s;h++){var I=a[h];u||(t.delete(I.k),A(r,I.prev,I.next)),se(I.e,!u)}})}function Ke(r,a,e,t,l,s=null){var n=r,u={flags:a,items:new Map,first:null};{var _=r;n=T?K(me(_)):_.appendChild(ae())}T&&he();var h=null,I=!1,N=new Map,i=pe(()=>{var f=e();return xe(f)?f:f==null?[]:te(f)}),g,v;function c(){Le(v,g,u,N,n,l,a,t,e),s!==null&&(g.length===0?h?re(h):h=J(()=>s(n)):h!==null&&Ne(h,()=>{h=null}))}ge(()=>{v??=Re,g=b(i);var f=g.length;if(I&&f===0)return;I=f===0;let x=!1;if(T){var p=be(n)===Ie;p!==(f===0)&&(n=$(),K(n),L(!1),x=!0)}if(T){for(var o=null,m,d=0;d<f;d++){if(z.nodeType===we&&z.data===Ee){n=z,x=!0,L(!1);break}var w=g[d],M=t(w,d);m=Q(z,u,o,null,w,M,d,l,a,e),u.items.set(M,m),o=m}f>0&&K($())}if(T)f===0&&s&&(h=J(()=>s(n)));else if(Me()){var S=new Set,E=ye;for(d=0;d<f;d+=1){w=g[d],M=t(w,d);var k=u.items.get(M)??N.get(M);k?ve(k,w,d):(m=Q(null,u,null,null,w,M,d,l,a,e,!0),N.set(M,m)),S.add(M)}for(const[U,q]of u.items)S.has(U)||E.skipped_effects.add(q.e);E.add_callback(c)}else c();x&&L(!0),b(i)}),T&&(n=z)}function Le(r,a,e,t,l,s,n,u,_){var h=a.length,I=e.items,N=e.first,i=N,g,v=null,c=[],f=[],x,p,o,m;for(m=0;m<h;m+=1){if(x=a[m],p=u(x,m),o=I.get(p),o===void 0){var d=t.get(p);if(d!==void 0){t.delete(p),I.set(p,d);var w=v?v.next:i;A(e,v,d),A(e,d,w),X(d,w,l),v=d}else{var M=i?i.e.nodes_start:l;v=Q(M,e,v,v===null?e.first:v.next,x,p,m,s,n,_)}I.set(p,v),c=[],f=[],i=v.next;continue}if(ve(o,x,m),(o.e.f&V)!==0&&re(o.e),o!==i){if(g!==void 0&&g.has(o)){if(c.length<f.length){var S=f[0],E;v=S.prev;var k=c[0],U=c[c.length-1];for(E=0;E<c.length;E+=1)X(c[E],S,l);for(E=0;E<f.length;E+=1)g.delete(f[E]);A(e,k.prev,U.next),A(e,v,k),A(e,U,S),i=S,v=U,m-=1,c=[],f=[]}else g.delete(o),X(o,i,l),A(e,o.prev,o.next),A(e,o,v===null?e.first:v.next),A(e,v,o),v=o;continue}for(c=[],f=[];i!==null&&i.k!==p;)(i.e.f&V)===0&&(g??=new Set).add(i),f.push(i),i=i.next;if(i===null)continue;o=i}c.push(o),v=o,i=o.next}if(i!==null||g!==void 0){for(var q=g===void 0?[]:te(g);i!==null;)(i.e.f&V)===0&&q.push(i),i=i.next;var ce=q.length;if(ce>0){var fe=h===0?l:null;Ge(e,q,fe)}}r.first=e.first&&e.first.e,r.last=v&&v.e;for(var de of t.values())se(de.e);t.clear()}function ve(r,a,e,t){Ce(r.v,a),r.i=e}function Q(r,a,e,t,l,s,n,u,_,h,I){var N=(_&Te)!==0,i=(_&De)===0,g=N?i?Ae(l,!1,!1):ee(l):l,v=(_&Se)===0?n:ee(n),c={i:v,v:g,k:s,a:null,e:null,prev:e,next:t};try{if(r===null){var f=document.createDocumentFragment();f.append(r=ae())}return c.e=J(()=>u(r,g,v,h),T),c.e.prev=e&&e.e,c.e.next=t&&t.e,e===null?I||(a.first=c):(e.next=c,e.e.next=c.e),t!==null&&(t.prev=c,t.e.prev=c.e),c}finally{}}function X(r,a,e){for(var t=r.next?r.next.e.nodes_start:e,l=a?a.e.nodes_start:e,s=r.e.nodes_start;s!==null&&s!==t;){var n=ke(s);l.before(s),s=n}}function A(r,a,e){a===null?r.first=e:(a.next=e,a.e.next=e&&e.e),e!==null&&(e.prev=a,e.e.prev=a&&a.e)}function Ve(r,a,e){var t=r==null?"":""+r;return t=t?t+" "+a:a,t===""?null:t}function Xe(r,a,e,t,l,s){var n=r.__className;if(T||n!==e||n===void 0){var u=Ve(e,t);(!T||u!==r.getAttribute("class"))&&(u==null?r.removeAttribute("class"):r.className=u),r.__className=e}return s}var Ye=R("<div><span> </span> <br/> <small> </small></div>");function Je(r,a){B(a,!0);let e=H("");a.incoming==!0?y(e,"Incoming"):y(e,"Outgoing");var t=Ye(),l=D(t),s=D(l,!0);C(l);var n=O(l,4),u=D(n,!0);C(n),C(t),ne(()=>{Xe(t,1,`Message ${b(e)??""}`,"svelte-1y5lfch"),Y(s,a.message.content),Y(u,a.message.timestamp)}),F(r,t),G()}async function Pe(r,a,e,t){const l=localStorage.getItem("jwt_auth")??"";await a.sendDirectMessage({message:{sender:localStorage.getItem("phone_number")??"",receiver:e.contact,content:b(t)}},{headers:{Authorization:l}}).then(s=>{e.messages.push(s.message)}).catch(s=>{console.error(s)}).finally(()=>{y(t,"")})}var Qe=R('<div class="svelte-o0dics"><input name="chat_input" id="chat_input" class="svelte-o0dics"/> <button>Send</button></div>');function We(r,a){B(a,!0);let e=H("");const t=W({baseUrl:"/"}),l=Z(j,t);var s=Qe(),n=D(s);ie(n);var u=O(n,2);u.__click=[Pe,l,a,e],C(s),oe(n,()=>b(e),_=>y(e,_)),F(r,s),G()}ue(["click"]);var Ze=R('<div id="Conversation" class="svelte-1eiq5x5"></div> <!>',1);function je(r,a){B(a,!0);let e=localStorage.getItem("phone_number")??"";const t=W({baseUrl:"/"});Z(j,t);var l=Ze(),s=P(l);Ke(s,21,()=>a.messages,Be,(u,_)=>{{let h=le(()=>b(_).sender!=e);Je(u,{get message(){return b(_)},get incoming(){return b(h)}})}}),C(s);var n=O(s,2);We(n,{get contact(){return a.contact},get messages(){return a.messages}}),F(r,l),G()}async function $e(r,a,e,t,l,s,n){const u=localStorage.getItem("jwt_auth")??"";await a.getUserInfo({phoneNumber:b(e)},{headers:{Authorization:u}}).catch(_=>{y(t,_,!0)}).then(_=>{_?y(l,_??null,!0):y(t,Error("User unknown"),!0)}).finally(async()=>{console.log("Getting"),y(s,!b(s)),await n()})}var ea=R('<label for="phone">Phone number</label> <input name="phone" type="text" required/> <button>Chat</button>',1),aa=(r,a)=>{y(a,!b(a))},ta=R('<div class="ChatHeader svelte-1swd458"><button>Back</button> <span class="ChatTitle svelte-1swd458"> </span></div> <!>',1),ra=R('<main><div class="Form"><div class="FormField"><!></div></div></main>');function va(r,a){B(a,!0);let e=H(""),t=H(Ue([])),l=H(void 0),s=H(void 0),n=H(!0),u;_e(()=>{u=localStorage.getItem("phone_number")??""});const _=W({baseUrl:"/"}),h=Z(j,_);let I=new Date(0).toISOString();async function N(){console.log("called");const p=localStorage.getItem("jwt_auth")??"";for await(const o of h.getDMs({userA:u,userB:b(s)?.phoneNumber,fromDate:I},{headers:{Authorization:p}}))console.log("Got messages"),o.messages.length!=0&&y(t,b(t).concat(o.messages),!0)}var i=ra(),g=D(i),v=D(g),c=D(v);{var f=p=>{var o=ea(),m=O(P(o),2);ie(m),ze(m,"pattern","^.{8,}$");var d=O(m,2);d.__click=[$e,h,e,l,s,n,N],oe(m,()=>b(e),w=>y(e,w)),F(p,o)},x=p=>{var o=ta(),m=P(o),d=D(m);d.__click=[aa,n];var w=O(d,2),M=D(w,!0);C(w),C(m);var S=O(m,2);{let E=le(()=>b(s)?.phoneNumber);je(S,{get contact(){return b(E)},get messages(){return b(t)},set messages(k){y(t,k,!0)}})}ne(()=>Y(M,b(s)?.username??"No user")),F(p,o)};qe(c,p=>{b(n)?p(f):p(x,!1)})}C(v),C(g),C(i),F(r,i),G()}ue(["click"]);export{va as component};
